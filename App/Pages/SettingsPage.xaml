<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="App.Pages.SettingsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:App.Pages"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" xmlns:viewmodels="using:App.ViewModels" d:DataContext="{d:DesignInstance Type=viewmodels:SettingsViewModel}"
	mc:Ignorable="d">

	<ScrollViewer>
		<StackPanel Padding="16" Spacing="8" MaxWidth="800" HorizontalAlignment="Center">

			<!-- Page Header -->
			<TextBlock Text="MQTT Broker Settings"
                       Style="{StaticResource TitleTextBlockStyle}"/>

			<!-- Status InfoBar -->
			<InfoBar Title="{x:Bind ViewModel.StatusTitle, Mode=OneWay}"
                     Message="{x:Bind ViewModel.StatusMessage, Mode=OneWay}"
                     Severity="{x:Bind ViewModel.StatusSeverity, Mode=OneWay}"
                     IsOpen="{x:Bind ViewModel.IsStatusOpen, Mode=TwoWay}"
                     IsClosable="True"/>

			<!-- Broker Connection Settings -->
			<Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    BorderThickness="1"
                    CornerRadius="8"
                    Padding="16">
				<StackPanel Spacing="16">
					<TextBlock Text="Broker Connection"
                               Style="{StaticResource SubtitleTextBlockStyle}"/>

					<!-- Host -->
					<Grid ColumnSpacing="12">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="140"/>
							<ColumnDefinition Width="*"/>
						</Grid.ColumnDefinitions>

						<TextBlock Text="Host:"
                                   VerticalAlignment="Center"
                                   Grid.Column="0"/>
						<TextBox Text="{x:Bind ViewModel.Host, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                 PlaceholderText="e.g. localhost or mqtt.example.com"
                                 Grid.Column="1"/>
					</Grid>

					<!-- Port -->
					<Grid ColumnSpacing="12">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="140"/>
							<ColumnDefinition Width="*"/>
						</Grid.ColumnDefinitions>

						<TextBlock Text="Port:"
                                   VerticalAlignment="Center"
                                   Grid.Column="0"/>
						<NumberBox Value="{x:Bind ViewModel.Port, Mode=TwoWay}"
                                   SpinButtonPlacementMode="Inline"
                                   Minimum="1"
                                   Maximum="65535"
                                   SmallChange="1"
                                   Grid.Column="1"/>
					</Grid>

					<!-- Use TLS -->
					<CheckBox IsChecked="{x:Bind ViewModel.UseTls, Mode=TwoWay}"
                              Content="Use TLS/SSL Encryption"/>
				</StackPanel>
			</Border>

			<!-- Advanced Connection Settings -->
			<Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    BorderThickness="1"
                    CornerRadius="8"
                    Padding="16">
				<StackPanel Spacing="16">
					<TextBlock Text="Advanced Connection Settings"
                               Style="{StaticResource SubtitleTextBlockStyle}"/>

					<!-- Timeout -->
					<Grid ColumnSpacing="12">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="140"/>
							<ColumnDefinition Width="*"/>
						</Grid.ColumnDefinitions>

						<TextBlock Text="Timeout (seconds):"
                                   VerticalAlignment="Center"
                                   Grid.Column="0"/>
						<NumberBox Value="{x:Bind ViewModel.TimeoutSeconds, Mode=TwoWay}"
                                   SpinButtonPlacementMode="Inline"
                                   Minimum="1"
                                   Maximum="60"
                                   SmallChange="1"
                                   Grid.Column="1"
                                   Header=""
                                   PlaceholderText="Default: 10"/>
					</Grid>

					<!-- Keep Alive Period -->
					<Grid ColumnSpacing="12">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="140"/>
							<ColumnDefinition Width="*"/>
						</Grid.ColumnDefinitions>

						<TextBlock Text="Keep Alive (seconds):"
                                   VerticalAlignment="Center"
                                   Grid.Column="0"/>
						<NumberBox Value="{x:Bind ViewModel.KeepAlivePeriodSeconds, Mode=TwoWay}"
                                   SpinButtonPlacementMode="Inline"
                                   Minimum="1"
                                   Maximum="300"
                                   SmallChange="5"
                                   Grid.Column="1"
                                   Header=""
                                   PlaceholderText="Default: 15"/>
					</Grid>

					<InfoBar Title="Advanced Settings"
                             Message="Timeout: Maximum time to wait for connection. Keep Alive: Interval for MQTT ping messages to keep connection alive."
                             Severity="Informational"
                             IsOpen="True"
                             IsClosable="False"/>
				</StackPanel>
			</Border>

			<!-- Authentication -->
			<Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    BorderThickness="1"
                    CornerRadius="8"
                    Padding="16">
				<StackPanel Spacing="16">
					<TextBlock Text="Authentication"
                               Style="{StaticResource SubtitleTextBlockStyle}"/>

					<!-- Username -->
					<Grid ColumnSpacing="12">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="140"/>
							<ColumnDefinition Width="*"/>
						</Grid.ColumnDefinitions>

						<TextBlock Text="Username:"
                                   VerticalAlignment="Center"
                                   Grid.Column="0"/>
						<TextBox Text="{x:Bind ViewModel.Username, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                 PlaceholderText="Optional"
                                 Grid.Column="1"/>
					</Grid>

					<!-- Password -->
					<Grid ColumnSpacing="12">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="140"/>
							<ColumnDefinition Width="*"/>
						</Grid.ColumnDefinitions>

						<TextBlock Text="Password:"
                                   VerticalAlignment="Center"
                                   Grid.Column="0"/>
						<PasswordBox Password="{x:Bind ViewModel.Password, Mode=TwoWay}"
                                     PlaceholderText="Optional"
                                     Grid.Column="1"/>
					</Grid>
				</StackPanel>
			</Border>

			<!-- Topic Configuration -->
			<Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    BorderThickness="1"
                    CornerRadius="8"
                    Padding="16">
				<StackPanel Spacing="16">
					<TextBlock Text="Topic Configuration"
                               Style="{StaticResource SubtitleTextBlockStyle}"/>

					<!-- Topic -->
					<Grid ColumnSpacing="12">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="140"/>
							<ColumnDefinition Width="*"/>
						</Grid.ColumnDefinitions>

						<TextBlock Text="Base Topic:"
                                   VerticalAlignment="Center"
                                   Grid.Column="0"/>
						<TextBox Text="{x:Bind ViewModel.Topic, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                 PlaceholderText="e.g. factory/demo"
                                 Grid.Column="1"/>
					</Grid>

					<InfoBar Title="Topic Structure"
                             Message="Messages will be published to: {BaseTopic}/station/{StationName}"
                             Severity="Informational"
                             IsOpen="True"
                             IsClosable="False"/>
				</StackPanel>
			</Border>

			<!-- Save Button -->
			<Button Content="Save Settings"
                    Click="SaveSettings_Click"
                    Style="{StaticResource AccentButtonStyle}"
                    HorizontalAlignment="Right"
                    MinWidth="120"/>

		</StackPanel>
	</ScrollViewer>
</Page>
